# 网页管理系统部署指南

## 📦 部署包已创建

部署包文件：`admin-deploy-20250807-131611.tar.gz` (950KB)

## 🚀 快速部署步骤

### 1. 上传文件到服务器
```bash
# 使用scp上传（替换your-server为您的服务器信息）
scp admin-deploy-20250807-131611.tar.gz user@your-server:/path/to/deploy/

# 或使用其他文件传输工具上传
```

### 2. 在服务器上解压和安装
```bash
# 解压文件
tar -xzf admin-deploy-20250807-131611.tar.gz

# 进入目录
cd admin-deploy-20250807-131611

# 安装依赖
npm install
```

### 3. 启动服务

#### 方式1：直接启动（开发测试）
```bash
node server.js
```

#### 方式2：使用PM2（生产环境推荐）
```bash
# 安装PM2
npm install -g pm2

# 启动服务
pm2 start ecosystem.config.js

# 设置开机自启
pm2 startup
pm2 save
```

#### 方式3：使用Docker
```bash
# 构建并启动容器
docker-compose up -d
```

### 4. 配置域名（可选）

#### Nginx配置示例
```nginx
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

#### SSL证书配置
```bash
# 使用Let's Encrypt获取SSL证书
sudo certbot --nginx -d your-domain.com
```

## 🌐 访问地址

- **主页面**：http://your-server-ip:3000
- **产品编辑测试**：http://your-server-ip:3000/test-product-edit.html
- **行程安排测试**：http://your-server-ip:3000/test-itinerary.html

## ✨ 功能特性

### 产品管理
- ✅ 产品增删改查
- ✅ 图片上传功能（支持多图）
- ✅ 价格日历管理（可视化编辑）
- ✅ 行程安排管理
- ✅ 费用说明管理
- ✅ 预订须知管理
- ✅ 标签管理
- ✅ 响应式设计

### 数据管理
- ✅ 区域管理
- ✅ 轮播图管理
- ✅ 订单管理
- ✅ 统计仪表盘

### 技术特性
- ✅ 与小程序数据完全同步
- ✅ 支持本地存储和云端存储
- ✅ 实时数据验证
- ✅ 移动端适配
- ✅ 错误处理和容错机制

## 🔧 服务器要求

### 最低配置
- **操作系统**：Linux/Ubuntu 18.04+
- **Node.js**：版本 14.0+
- **内存**：512MB+
- **存储**：1GB+
- **网络**：公网IP或域名

### 推荐配置
- **操作系统**：Ubuntu 20.04 LTS
- **Node.js**：版本 16.0+
- **内存**：2GB+
- **存储**：10GB+
- **网络**：独立域名 + SSL证书

## 📋 部署检查清单

### 服务器准备
- [ ] 安装Node.js (>= 14)
- [ ] 安装npm
- [ ] 配置防火墙（开放3000端口）
- [ ] 配置域名解析（可选）

### 文件部署
- [ ] 上传部署包到服务器
- [ ] 解压文件
- [ ] 安装依赖
- [ ] 配置环境变量

### 服务启动
- [ ] 测试服务启动
- [ ] 配置PM2（生产环境）
- [ ] 设置开机自启
- [ ] 配置日志轮转

### 域名配置
- [ ] 配置Nginx反向代理
- [ ] 申请SSL证书
- [ ] 配置HTTPS
- [ ] 测试访问

## 🔍 故障排除

### 常见问题

#### 1. 端口被占用
```bash
# 检查端口占用
lsof -i :3000

# 杀死占用进程
kill -9 <PID>
```

#### 2. 服务启动失败
```bash
# 检查Node.js版本
node --version

# 检查依赖安装
npm list

# 查看错误日志
pm2 logs admin-server
```

#### 3. 无法访问
```bash
# 检查服务状态
pm2 status

# 检查防火墙
sudo ufw status

# 检查Nginx配置
sudo nginx -t
```

#### 4. 数据库连接失败
```bash
# 检查网络连接
ping api.weixin.qq.com

# 检查API密钥配置
cat js/config.js
```

### 日志查看
```bash
# PM2日志
pm2 logs admin-server

# 系统日志
journalctl -u admin-server

# Nginx日志
sudo tail -f /var/log/nginx/access.log
```

## 🔒 安全配置

### 1. 防火墙配置
```bash
# 只开放必要端口
sudo ufw allow 22    # SSH
sudo ufw allow 80    # HTTP
sudo ufw allow 443   # HTTPS
sudo ufw enable
```

### 2. 用户权限
```bash
# 创建专用用户
sudo adduser admin-user
sudo usermod -aG sudo admin-user

# 设置文件权限
sudo chown -R admin-user:admin-user /path/to/admin
```

### 3. SSL证书
```bash
# 使用Let's Encrypt
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

## 📊 监控和维护

### 1. 进程监控
```bash
# 查看PM2状态
pm2 status

# 查看资源使用
pm2 monit
```

### 2. 日志管理
```bash
# 配置日志轮转
sudo nano /etc/logrotate.d/admin-server

# 日志轮转配置
/path/to/admin/logs/*.log {
    daily
    missingok
    rotate 7
    compress
    delaycompress
    notifempty
    create 644 admin-user admin-user
}
```

### 3. 备份策略
```bash
# 创建备份脚本
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
tar -czf backup_$DATE.tar.gz /path/to/admin
```

## 📞 技术支持

### 联系方式
- **项目地址**：/Users/huhaitao/WeChatProjects/miniprogram-5
- **部署包**：admin-deploy-20250807-131611.tar.gz
- **文档**：部署指南.md

### 相关文件
- `deploy-admin.sh` - 部署脚本
- `create-deploy-package.sh` - 打包脚本
- `admin/` - 源代码目录
- `admin/DEPLOY-README.md` - 详细部署说明

## 🎉 部署完成

部署完成后，您可以通过以下地址访问：

- **主管理系统**：http://your-domain.com
- **产品编辑测试**：http://your-domain.com/test-product-edit.html
- **行程安排测试**：http://your-domain.com/test-itinerary.html

所有功能都已与小程序版本完全同步，支持完整的产品管理功能！ 