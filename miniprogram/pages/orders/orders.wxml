<!--orders.wxml-->
<view class="container">
  <!-- 订单状态切换 -->
  <view class="status-tabs">
    <view class="tab-item {{currentStatus === 'all' ? 'active' : ''}}" bindtap="switchStatus" data-status="all">
      <text>全部</text>
    </view>
    <view class="tab-item {{currentStatus === 'pending' ? 'active' : ''}}" bindtap="switchStatus" data-status="pending">
      <text>待付款</text>
    </view>
    <view class="tab-item {{currentStatus === 'paid' ? 'active' : ''}}" bindtap="switchStatus" data-status="paid">
      <text>已付款</text>
    </view>
    <view class="tab-item {{currentStatus === 'confirmed' ? 'active' : ''}}" bindtap="switchStatus" data-status="confirmed">
      <text>已确认</text>
    </view>
    <view class="tab-item {{currentStatus === 'completed' ? 'active' : ''}}" bindtap="switchStatus" data-status="completed">
      <text>已完成</text>
    </view>
    <view class="tab-item {{currentStatus === 'refunded' ? 'active' : ''}}" bindtap="switchStatus" data-status="refunded">
      <text>已退款</text>
    </view>
  </view>

  <!-- 订单列表 -->
  <view class="order-list" wx:if="{{orders.length > 0}}">
    <view class="order-item" wx:for="{{orders}}" wx:key="_id">
      <view class="order-header">
        <text class="order-number">订单号：{{item.orderNo}}</text>
        <text class="order-status {{item.status}}">{{item.statusText}}</text>
      </view>
      
      <view class="order-content" bindtap="goToOrderDetail" data-id="{{item._id}}">
        <view class="product-image-section">
          <image src="{{item.productImage}}" class="product-image" mode="aspectFill" />
          <view class="product-info">
            <view class="product-title">{{item.productTitle}}</view>
            
            <view class="travel-info">
              <view class="info-item travel-date">
                <text>出行日期：{{item.travelDate}}</text>
              </view>
              <view class="info-item travelers">
                <text>成人：{{item.adultCount}}人</text>
                <text wx:if="{{item.childCount > 0}}">儿童：{{item.childCount}}人</text>
              </view>
            </view>
          </view>
        </view>
        
        <view class="price-section">
          <view class="price-info">
            <text class="price-label">订单总价</text>
            <text class="price-value">¥{{item.totalPrice}}</text>
          </view>
          <view class="price-detail">
            <text>含服务费</text>
          </view>
        </view>
      </view>
      
      <view class="order-actions">
        <!-- 待付款状态 -->
        <button wx:if="{{item.status === 'pending'}}" class="btn-primary" bindtap="payOrder" data-id="{{item._id}}">立即付款</button>
        <button wx:if="{{item.status === 'pending'}}" class="btn-cancel" bindtap="cancelOrder" data-id="{{item._id}}">取消订单</button>
        
        <!-- 已付款状态 -->
        <button wx:if="{{item.status === 'paid'}}" class="btn-secondary" bindtap="viewDetails" data-id="{{item._id}}">查看详情</button>
        <button wx:if="{{item.status === 'paid'}}" class="btn-refund" bindtap="requestRefund" data-id="{{item._id}}">申请退款</button>
        
        <!-- 已确认状态 -->
        <button wx:if="{{item.status === 'confirmed'}}" class="btn-secondary" bindtap="viewDetails" data-id="{{item._id}}">查看详情</button>
        
        <!-- 已完成状态 -->
        <button wx:if="{{item.status === 'completed'}}" class="btn-secondary" bindtap="writeReview" data-id="{{item._id}}">写评价</button>
        
        <!-- 已退款状态 -->
        <button wx:if="{{item.status === 'refunded'}}" class="btn-secondary" bindtap="viewDetails" data-id="{{item._id}}">查看详情</button>
        <button wx:if="{{item.status === 'refunded'}}" class="btn-delete" bindtap="deleteOrder" data-id="{{item._id}}">删除订单</button>
        
        <!-- 已取消状态 -->
        <button wx:if="{{item.status === 'cancelled'}}" class="btn-secondary" bindtap="viewDetails" data-id="{{item._id}}">查看详情</button>
        <button wx:if="{{item.status === 'cancelled'}}" class="btn-delete" bindtap="deleteOrder" data-id="{{item._id}}">删除订单</button>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view class="empty-state" wx:if="{{orders.length === 0 && !loading}}">
    <image src="/images/default-goods-image.png" class="empty-image" />
    <text class="empty-text">暂无订单</text>
  </view>

  <!-- 加载更多 -->
  <view class="load-more" wx:if="{{hasMore && orders.length > 0}}">
    <button class="btn-primary" bindtap="loadMore" loading="{{loading}}">加载更多</button>
  </view>
</view> 